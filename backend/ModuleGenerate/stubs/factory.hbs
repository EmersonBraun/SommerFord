import Factory from '@ioc:Adonis/Lucid/Factory'

import {{module.name.pascalCase}} from 'App/Models/{{module.name.pascalCase}}'

{{#if module.relations}}
{{#each module.relations}}
import { random{{modelName}}Id } from './{{modelName}}Factory'
{{/each}}
{{/if}}

{{#if module.relations}}
export const {{module.name.pascalCase}}Factory = Factory
  .define({{module.name.pascalCase}}, async () => ({
    {{#each module.fields}}
    {{name}}: faker.{{specificType}},
    {{/each}}
    {{#each module.relations}}
    {{field}}: await random{{name}}Id(),
    {{/each}}
  }))
  .build()
{{/if}}
{{#unless module.relations}}
export const {{module.name.pascalCase}}Factory = Factory
  .define({{module.name.pascalCase}}, () => ({
    {{#each module.fields}}
    {{name}}: faker.{{specificType}}(),
    {{/each}}
  }))
  .build()
{{/unless}}

export async function random{{module.name.pascalCase}}Id () {
  const req = await {{module.name.pascalCase}}.query().select('id')
  if (!req) {
    return 0
  }
  const ids = req.map(r => r.id)
  return ids[Math.floor(Math.random() * ids.length)]
}